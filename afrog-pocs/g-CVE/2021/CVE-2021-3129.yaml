id: CVE-2021-3129

info:
    name: LARAVEL <= V8.4.2 DEBUG MODE - REMOTE CODE EXECUTION
    author: Jarcis-cy(https://github.com/Jarcis-cy)
    severity: critical

set:
  r: randomLowercase(12)
rules:
  r0:
    request:
      method: POST
      path: /_ignition/execute-solution
      headers:
        Content-Type: application/json
      body: |-
        {
                "solution": "Facade\\Ignition\\Solutions\\MakeViewVariableOptionalSolution",
                "parameters": {
                  "variableName": "username",
                  "viewFile": "{{r}}"
                }
        }
      follow_redirects: true
    expression: >
      response.status == 500 && response.body.bcontains(bytes("file_get_contents(" + string(r) + ")")) && response.body.bcontains(bytes("failed to open stream"))
expression: r0()

